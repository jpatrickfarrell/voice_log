{% extends "base.html" %}

{% block title %}Profile - {{ user.username }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-lg-8 mx-auto">
            <!-- Profile Header -->
            <div class="card mb-4">
                <div class="card-header">
                    <h2 class="mb-0">
                        <i class="bi bi-person-circle"></i> Profile Settings
                    </h2>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h5>Account Information</h5>
                            <p><strong>Username:</strong> {{ user.username }}</p>
                            <p><strong>Email:</strong> {{ user.email }}</p>
                            <p><strong>Member since:</strong> 
                            {% if user.created_at %}
                                {% if user.created_at is string %}
                                    {% set date_str = user.created_at %}
                                    {% if date_str|length > 19 %}
                                        {% set date_parts = date_str.split(' ') %}
                                        {% set date_only = date_parts[0] %}
                                        {% set year = date_only.split('-')[0] %}
                                        {% set month = date_only.split('-')[1] %}
                                        {% set day = date_only.split('-')[2] %}
                                        {% set month_names = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'] %}
                                        {{ month_names[month|int - 1] }} {{ day|int }}, {{ year }}
                                    {% else %}
                                        {{ date_str }}
                                    {% endif %}
                                {% else %}
                                    {{ user.created_at.strftime('%B %d, %Y') }}
                                {% endif %}
                            {% else %}
                                Unknown
                            {% endif %}
                        </p>
                        </div>
                        <div class="col-md-6">
                            <h5>Statistics</h5>
                            <p><strong>Total Posts:</strong> {{ user.get_post_count() }}</p>
                            <p><strong>Account Status:</strong> 
                                <span class="badge bg-success">Active</span>
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Training Section -->
            <div class="card mb-4">
                <div class="card-header">
                    <h3 class="mb-0">
                        <i class="bi bi-robot"></i> AI Training - Make Posts Sound Like You
                    </h3>
                </div>
                <div class="card-body">
                    <p class="text-muted mb-4">
                        Help the AI understand your writing style and personality so it can generate blog posts that sound authentically like you.
                    </p>
                    
                    <form method="POST" action="{{ url_for('auth.update_ai_training') }}">
                        <!-- Personal Bio -->
                        <div class="mb-4">
                            <label for="ai_bio" class="form-label">
                                <strong>Personal Bio (First Person)</strong>
                            </label>
                            <textarea 
                                class="form-control" 
                                id="ai_bio" 
                                name="ai_bio" 
                                rows="6" 
                                placeholder="Tell the AI about yourself in first person. For example: 'I'm a passionate entrepreneur who loves helping others succeed. I believe in practical, actionable advice and sharing real experiences. I write in a conversational, encouraging tone and always try to provide value to my readers...'"
                            >{{ user.ai_bio or '' }}</textarea>
                            <div class="form-text">
                                Write about who you are, what you care about, your expertise, and what you have to offer. 
                                This helps the AI understand your voice and perspective.
                            </div>
                        </div>

                        <!-- Writing Samples -->
                        <div class="mb-4">
                            <label for="ai_writing_samples" class="form-label">
                                <strong>Writing Style Samples</strong>
                            </label>
                            <textarea 
                                class="form-control" 
                                id="ai_writing_samples" 
                                name="ai_writing_samples" 
                                rows="8" 
                                placeholder="Paste examples of your writing style here. You can include blog posts, articles, emails, or any text that represents how you communicate. The AI will learn from these examples to match your tone, vocabulary, and writing patterns."
                            >{{ user.ai_writing_samples or '' }}</textarea>
                            <div class="form-text">
                                Include samples of your writing to teach the AI your style. You can paste markdown, plain text, or any format.
                                The more examples you provide, the better the AI will understand your voice.
                            </div>
                        </div>

                        <!-- Tips Section -->
                        <div class="alert alert-info">
                            <h6><i class="bi bi-lightbulb"></i> Tips for Better AI Training:</h6>
                            <ul class="mb-0">
                                <li><strong>Be specific:</strong> Include details about your background, expertise, and values</li>
                                <li><strong>Show your voice:</strong> Use the same tone and style you want in your posts</li>
                                <li><strong>Include examples:</strong> The more writing samples, the better the AI learns</li>
                                <li><strong>Update regularly:</strong> Refine your training data as your style evolves</li>
                            </ul>
                        </div>

                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="bi bi-save"></i> Save AI Training Data
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Change Password Section -->
            <div class="card mb-4">
                <div class="card-header">
                    <h3 class="mb-0">
                        <i class="bi bi-shield-lock"></i> Change Password
                    </h3>
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('auth.change_password') }}">
                        <div class="mb-3">
                            <label for="current_password" class="form-label">Current Password</label>
                            <input type="password" class="form-control" id="current_password" name="current_password" required>
                        </div>
                        <div class="mb-3">
                            <label for="new_password" class="form-label">New Password</label>
                            <input type="password" class="form-control" id="new_password" name="new_password" required>
                        </div>
                        <div class="mb-3">
                            <label for="confirm_password" class="form-label">Confirm New Password</label>
                            <input type="password" class="form-control" id="confirm_password" name="confirm_password" required>
                        </div>
                        <div class="d-grid">
                            <button type="submit" class="btn btn-outline-primary">
                                <i class="bi bi-key"></i> Update Password
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Back to Dashboard -->
            <div class="text-center mb-4">
                <a href="{{ url_for('main.dashboard') }}" class="btn btn-outline-secondary">
                    <i class="bi bi-arrow-left"></i> Back to Dashboard
                </a>
            </div>
        </div>
    </div>
</div>

<style>
.card {
    border: none;
    box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
    border-radius: 0.5rem;
}

.card-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 0.5rem 0.5rem 0 0 !important;
    border: none;
}

.card-header h2, .card-header h3 {
    margin: 0;
    font-weight: 600;
}

.form-control:focus {
    border-color: #667eea;
    box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
}

.btn-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: none;
    border-radius: 0.5rem;
}

.btn-primary:hover {
    background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
    transform: translateY(-1px);
}

.alert-info {
    background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
    border: 1px solid #90caf9;
    border-radius: 0.5rem;
}

.badge {
    font-size: 0.875rem;
    padding: 0.5rem 0.75rem;
    border-radius: 0.375rem;
}
</style>
{% endblock %}
